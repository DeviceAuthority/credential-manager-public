
/*
 * Copyright (c) 2024 Device Authority. - All rights reserved. - www.deviceauthority.com
 *
 * Unit tests of the win cert store that writes to the Windows Certificate Store using the Wincrypt API
 */
#ifndef WINCRYPT_CERT_STORE_UNITTEST_HPP
#define WINCRYPT_CERT_STORE_UNITTEST_HPP

#include <Windows.h>
#include <string>
#include <wincrypt.h>
#include "gtest/gtest.h"
#include "wincrypt_cert_store.hpp"

class WincryptCertStoreTest : public testing::Test
{
    public:
    WincryptCertStore m_cert_store;

    WincryptCertStoreTest()
        : m_cert_store{ WincryptCertStore(true, false) }
    {

    }

    void SetUp() override
    {
        ASSERT_TRUE(m_cert_store.initialize());
    }

    void TearDown() override
    {
        m_cert_store.shutdown();
    }
};

TEST_F(WincryptCertStoreTest, parseChainFile)
{
    std::string cert_chain = "-----BEGIN CERTIFICATE-----\nMIIDJjCCAg4CAQEwDQYJKoZIhvcNAQELBQAwWTELMAkGA1UEBhMCQVUxEzARBgNV\nBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0\nZDESMBAGA1UEAwwJdGVzdCB0ZXN0MB4XDTI0MDUxMzExNTY1MFoXDTI1MDUxMzEx\nNTY1MFowWTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNV\nBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDESMBAGA1UEAwwJdGVzdCB0ZXN0\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsIMri9wZBQEyEXP82Sf0\nXCxVx529IPDsjz4AnEBppNDXBn8QK8o6BYjetPudiqNuXsyzTBXZR1/4p0GxYIzL\n+jHJqTfNEmH5hI4vA0UJEAEo9ERB3AiFABjC4q2zmmkFYW92S4oXZVO4jKSt+FO5\n/SSShLXHKSyUN8u4SPCJ/t0WfV6LTOUflYzWb0whWt8ezVPFjPO2Zy1Wc30/rSEz\n5GpG+vHPnCCMtBsPgt6NaN3gBWf47wYLBeI9dooCOY5OkbpWfPK6bl8Epti13EXb\nO1y1hqIHJRFdDuKvOPqWFGffqa6xjQ4u7FyGpuSAtOFaV5ntRcG13E6o8DhmMIHL\nVQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQAR2M9fDe9x8ZNibWeYuD7WYAIedjI/\nNZsYdylD+5bII2Vj1qDOlTlvMgpfBqu1RvUXmHedTpmjcjGduATKsg9HE31HrGrP\n+y1CpRQ/ePXIF7HEveFv6oyJE8LzRetB5h9MqFosPImmJYWx3bvW3kHP8aixoq1o\nDDqyY6jijrIW2w8NhcyrjEje3GiiXpUOI66OpzH+U1a+33icv5enVbKDsxg7JISF\nGwz4SMpKKkg5OEmky0ZkFIupk09LhMq0DsnOuZCKvipCjvrhfP7UMsE0PdXWYgl2\nm8nmpVOinTTuIfmlxnpS9PD/s5CH4zwyD6BvHE0OCzYiVOS0fwpc90Ak\n-----END CERTIFICATE-----\n\n-----BEGIN CERTIFICATE-----\nMIIDKDCCAhACAQIwDQYJKoZIhvcNAQELBQAwWTELMAkGA1UEBhMCQVUxEzARBgNV\nBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0\nZDESMBAGA1UEAwwJdGVzdCB0ZXN0MB4XDTI0MDUxMzExNTgxNFoXDTI1MDUxMzEx\nNTgxNFowWzELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNV\nBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDEUMBIGA1UEAwwLaW50ZXIgaW50\nZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC8gXqynWXfgHSu8Vet\n1gn4Nxs5MxNYtgubbtYLR8d4UCsRR+GET9/eFiG2ksUvsQ1Iv/f1vYkbAj6vqsga\nyhYcOkIBo4x0TN8z3I79eoAjeZQkH/jXs0vlmtHIoRxgLM4M0n5R6jICxGfeXakh\n7BMWAjPuGSkTMJk0lRFufkkdAEDjXUkAt7CrRFrA6mWh77lmOi0Yx/rviDxiLPZ3\nlfDhhRkCdF7daazIvAjVdmn/BA6IwJkP8YhzlYJCWyzS9VmfW1zIsUAo/WVgAw7T\nJQpBsIOUDt59ExjMiXzqy2TzoE++r28sRl1K0znI170AeHCZijUlqDpmm9q20PRL\n4KgFAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJwX5hA5Nr0y3YEZIbbxhu80kHvO\nUKKKKBSNOQIEW3RAZk6svhZb6vj075pmZrdG60TrlrmZczV0KRVUUnhXh5iT5gEf\nTtfhU+mmK3z+MsQEhaJNWHYcOP0sJlyrKhlUJjzl8gaZ2sP9q4EKj1R98p1XWzmC\nJWXfwe5wg7HbUzt18x6ifSf6QKMmLqPLCDKXnE+O5Th3YO/yCnFoTT0IIIEfv0Bd\nmhYlxVxRycAaywBGX907/g8siAM4gx0ZnWS4z58mnG/FxcuhiTeYLWa3Hqh7Fpg/\nbyWt+K+diYjemeS3b0DwckW6tp4BiDGMsQJ0NHTafT4z+VJ230Fzn0QfOMU=\n-----END CERTIFICATE-----\n\n-----BEGIN CERTIFICATE-----\nMIIDFDCCAfwCAQMwDQYJKoZIhvcNAQELBQAwWzELMAkGA1UEBhMCQVUxEzARBgNV\nBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0\nZDEUMBIGA1UEAwwLaW50ZXIgaW50ZXIwHhcNMjQwNTEzMTE1ODUyWhcNMjUwNTEz\nMTE1ODUyWjBFMQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8G\nA1UECgwYSW50ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIIBIjANBgkqhkiG9w0BAQEF\nAAOCAQ8AMIIBCgKCAQEAkkmEOhwgWEqIpju5lL22jYJCQ39ZPL8yXBJr5qznMyHF\npnZBn9iaHGpkPLdCuFT+ltfp2UtxGq/qEUo1TYlrYAClytpm2no2ykVk6JB0njrB\nF5mw4YPGblNSXZXyRVETWRN9sVvmijmLvvWk29Wrr5efNy2qwPgVVBlrfHf3VuSr\nBx0W7kjgeJ2NQB6WGDTBCNAY4fQVbKvdz4+mD2p7uuivPlo1muyb30voDHrxuNZM\n9wlY1hY5I0mUxOVCoGRh0ylPqDy5XlzNvUzDeCrGx0NCGSD8WLjNmpcrkIr5Dd8q\nG6Ptjj5wNHyI3PM3fam4wH4vUC5d0B6cfA9JoJMnJwIDAQABMA0GCSqGSIb3DQEB\nCwUAA4IBAQCWTsdnSYuLNHhMZUL3Cg2YCNd4N7sLsO3LFJNyVsGAyMhLxmPW1WYp\nrOx1b2DjgLjz1WxwLPq5QnfQ8YDfNHtnXTrRHe4PS7+bQk6AmFbpZR6z0iKb5q7D\nJzZtbmtLYPUshpGMU9t1XnSig2tPTbRcNzQbq6z2mKI07mpIMzpRCaJJL09a14OV\nlqBMdk2TTIdJJ0QgEsKbqfFCl9OvIOw+PvtWZXFkig2LyFYcyifdx+nkuQlm57LG\nxDZaftAXS6VaarzTBsBOm8pyjPsPxJUwxH4KpxJ6a2wN/Fn5KZhogJSUzZDGWhV8\nxy30rntRnNktRSKs5SbZveuOD8KjKxPF\n-----END CERTIFICATE-----\n";

    std::vector<std::string> certs{};
    ASSERT_TRUE(WincryptCertStore::extractCertsFromCertificateChain(cert_chain, certs));

    ASSERT_EQ(certs.size(), 3);
}

TEST_F(WincryptCertStoreTest, createExportAndDeletePfxTest)
{
    // -----BEGIN CERTIFICATE-----\nMIIDJjCCAg4CAQEwDQYJKoZIhvcNAQELBQAwWTELMAkGA1UEBhMCQVUxEzARBgNV\nBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0\nZDESMBAGA1UEAwwJdGVzdCB0ZXN0MB4XDTI0MDUxMzExNTY1MFoXDTI1MDUxMzEx\nNTY1MFowWTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNV\nBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDESMBAGA1UEAwwJdGVzdCB0ZXN0\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsIMri9wZBQEyEXP82Sf0\nXCxVx529IPDsjz4AnEBppNDXBn8QK8o6BYjetPudiqNuXsyzTBXZR1/4p0GxYIzL\n+jHJqTfNEmH5hI4vA0UJEAEo9ERB3AiFABjC4q2zmmkFYW92S4oXZVO4jKSt+FO5\n/SSShLXHKSyUN8u4SPCJ/t0WfV6LTOUflYzWb0whWt8ezVPFjPO2Zy1Wc30/rSEz\n5GpG+vHPnCCMtBsPgt6NaN3gBWf47wYLBeI9dooCOY5OkbpWfPK6bl8Epti13EXb\nO1y1hqIHJRFdDuKvOPqWFGffqa6xjQ4u7FyGpuSAtOFaV5ntRcG13E6o8DhmMIHL\nVQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQAR2M9fDe9x8ZNibWeYuD7WYAIedjI/\nNZsYdylD+5bII2Vj1qDOlTlvMgpfBqu1RvUXmHedTpmjcjGduATKsg9HE31HrGrP\n+y1CpRQ/ePXIF7HEveFv6oyJE8LzRetB5h9MqFosPImmJYWx3bvW3kHP8aixoq1o\nDDqyY6jijrIW2w8NhcyrjEje3GiiXpUOI66OpzH+U1a+33icv5enVbKDsxg7JISF\nGwz4SMpKKkg5OEmky0ZkFIupk09LhMq0DsnOuZCKvipCjvrhfP7UMsE0PdXWYgl2\nm8nmpVOinTTuIfmlxnpS9PD/s5CH4zwyD6BvHE0OCzYiVOS0fwpc90Ak\n-----END CERTIFICATE-----\n\n-----BEGIN CERTIFICATE-----\nMIIDKDCCAhACAQIwDQYJKoZIhvcNAQELBQAwWTELMAkGA1UEBhMCQVUxEzARBgNV\nBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0\nZDESMBAGA1UEAwwJdGVzdCB0ZXN0MB4XDTI0MDUxMzExNTgxNFoXDTI1MDUxMzEx\nNTgxNFowWzELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNV\nBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDEUMBIGA1UEAwwLaW50ZXIgaW50\nZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC8gXqynWXfgHSu8Vet\n1gn4Nxs5MxNYtgubbtYLR8d4UCsRR+GET9/eFiG2ksUvsQ1Iv/f1vYkbAj6vqsga\nyhYcOkIBo4x0TN8z3I79eoAjeZQkH/jXs0vlmtHIoRxgLM4M0n5R6jICxGfeXakh\n7BMWAjPuGSkTMJk0lRFufkkdAEDjXUkAt7CrRFrA6mWh77lmOi0Yx/rviDxiLPZ3\nlfDhhRkCdF7daazIvAjVdmn/BA6IwJkP8YhzlYJCWyzS9VmfW1zIsUAo/WVgAw7T\nJQpBsIOUDt59ExjMiXzqy2TzoE++r28sRl1K0znI170AeHCZijUlqDpmm9q20PRL\n4KgFAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJwX5hA5Nr0y3YEZIbbxhu80kHvO\nUKKKKBSNOQIEW3RAZk6svhZb6vj075pmZrdG60TrlrmZczV0KRVUUnhXh5iT5gEf\nTtfhU+mmK3z+MsQEhaJNWHYcOP0sJlyrKhlUJjzl8gaZ2sP9q4EKj1R98p1XWzmC\nJWXfwe5wg7HbUzt18x6ifSf6QKMmLqPLCDKXnE+O5Th3YO/yCnFoTT0IIIEfv0Bd\nmhYlxVxRycAaywBGX907/g8siAM4gx0ZnWS4z58mnG/FxcuhiTeYLWa3Hqh7Fpg/\nbyWt+K+diYjemeS3b0DwckW6tp4BiDGMsQJ0NHTafT4z+VJ230Fzn0QfOMU=\n-----END CERTIFICATE-----\n\n-----BEGIN CERTIFICATE-----\nMIIDFDCCAfwCAQMwDQYJKoZIhvcNAQELBQAwWzELMAkGA1UEBhMCQVUxEzARBgNV\nBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0\nZDEUMBIGA1UEAwwLaW50ZXIgaW50ZXIwHhcNMjQwNTEzMTE1ODUyWhcNMjUwNTEz\nMTE1ODUyWjBFMQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8G\nA1UECgwYSW50ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIIBIjANBgkqhkiG9w0BAQEF\nAAOCAQ8AMIIBCgKCAQEAkkmEOhwgWEqIpju5lL22jYJCQ39ZPL8yXBJr5qznMyHF\npnZBn9iaHGpkPLdCuFT+ltfp2UtxGq/qEUo1TYlrYAClytpm2no2ykVk6JB0njrB\nF5mw4YPGblNSXZXyRVETWRN9sVvmijmLvvWk29Wrr5efNy2qwPgVVBlrfHf3VuSr\nBx0W7kjgeJ2NQB6WGDTBCNAY4fQVbKvdz4+mD2p7uuivPlo1muyb30voDHrxuNZM\n9wlY1hY5I0mUxOVCoGRh0ylPqDy5XlzNvUzDeCrGx0NCGSD8WLjNmpcrkIr5Dd8q\nG6Ptjj5wNHyI3PM3fam4wH4vUC5d0B6cfA9JoJMnJwIDAQABMA0GCSqGSIb3DQEB\nCwUAA4IBAQCWTsdnSYuLNHhMZUL3Cg2YCNd4N7sLsO3LFJNyVsGAyMhLxmPW1WYp\nrOx1b2DjgLjz1WxwLPq5QnfQ8YDfNHtnXTrRHe4PS7+bQk6AmFbpZR6z0iKb5q7D\nJzZtbmtLYPUshpGMU9t1XnSig2tPTbRcNzQbq6z2mKI07mpIMzpRCaJJL09a14OV\nlqBMdk2TTIdJJ0QgEsKbqfFCl9OvIOw+PvtWZXFkig2LyFYcyifdx+nkuQlm57LG\nxDZaftAXS6VaarzTBsBOm8pyjPsPxJUwxH4KpxJ6a2wN/Fn5KZhogJSUzZDGWhV8\nxy30rntRnNktRSKs5SbZveuOD8KjKxPF\n-----END CERTIFICATE-----\n
    const std::string certificate = "-----BEGIN CERTIFICATE-----\nMIIDFDCCAfwCAQMwDQYJKoZIhvcNAQELBQAwWzELMAkGA1UEBhMCQVUxEzARBgNV\nBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0\nZDEUMBIGA1UEAwwLaW50ZXIgaW50ZXIwHhcNMjQwNTEzMTE1ODUyWhcNMjUwNTEz\nMTE1ODUyWjBFMQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8G\nA1UECgwYSW50ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIIBIjANBgkqhkiG9w0BAQEF\nAAOCAQ8AMIIBCgKCAQEAkkmEOhwgWEqIpju5lL22jYJCQ39ZPL8yXBJr5qznMyHF\npnZBn9iaHGpkPLdCuFT+ltfp2UtxGq/qEUo1TYlrYAClytpm2no2ykVk6JB0njrB\nF5mw4YPGblNSXZXyRVETWRN9sVvmijmLvvWk29Wrr5efNy2qwPgVVBlrfHf3VuSr\nBx0W7kjgeJ2NQB6WGDTBCNAY4fQVbKvdz4+mD2p7uuivPlo1muyb30voDHrxuNZM\n9wlY1hY5I0mUxOVCoGRh0ylPqDy5XlzNvUzDeCrGx0NCGSD8WLjNmpcrkIr5Dd8q\nG6Ptjj5wNHyI3PM3fam4wH4vUC5d0B6cfA9JoJMnJwIDAQABMA0GCSqGSIb3DQEB\nCwUAA4IBAQCWTsdnSYuLNHhMZUL3Cg2YCNd4N7sLsO3LFJNyVsGAyMhLxmPW1WYp\nrOx1b2DjgLjz1WxwLPq5QnfQ8YDfNHtnXTrRHe4PS7+bQk6AmFbpZR6z0iKb5q7D\nJzZtbmtLYPUshpGMU9t1XnSig2tPTbRcNzQbq6z2mKI07mpIMzpRCaJJL09a14OV\nlqBMdk2TTIdJJ0QgEsKbqfFCl9OvIOw+PvtWZXFkig2LyFYcyifdx+nkuQlm57LG\nxDZaftAXS6VaarzTBsBOm8pyjPsPxJUwxH4KpxJ6a2wN/Fn5KZhogJSUzZDGWhV8\nxy30rntRnNktRSKs5SbZveuOD8KjKxPF\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIDKDCCAhACAQIwDQYJKoZIhvcNAQELBQAwWTELMAkGA1UEBhMCQVUxEzARBgNV\nBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0\nZDESMBAGA1UEAwwJdGVzdCB0ZXN0MB4XDTI0MDUxMzExNTgxNFoXDTI1MDUxMzEx\nNTgxNFowWzELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNV\nBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDEUMBIGA1UEAwwLaW50ZXIgaW50\nZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC8gXqynWXfgHSu8Vet\n1gn4Nxs5MxNYtgubbtYLR8d4UCsRR+GET9/eFiG2ksUvsQ1Iv/f1vYkbAj6vqsga\nyhYcOkIBo4x0TN8z3I79eoAjeZQkH/jXs0vlmtHIoRxgLM4M0n5R6jICxGfeXakh\n7BMWAjPuGSkTMJk0lRFufkkdAEDjXUkAt7CrRFrA6mWh77lmOi0Yx/rviDxiLPZ3\nlfDhhRkCdF7daazIvAjVdmn/BA6IwJkP8YhzlYJCWyzS9VmfW1zIsUAo/WVgAw7T\nJQpBsIOUDt59ExjMiXzqy2TzoE++r28sRl1K0znI170AeHCZijUlqDpmm9q20PRL\n4KgFAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJwX5hA5Nr0y3YEZIbbxhu80kHvO\nUKKKKBSNOQIEW3RAZk6svhZb6vj075pmZrdG60TrlrmZczV0KRVUUnhXh5iT5gEf\nTtfhU+mmK3z+MsQEhaJNWHYcOP0sJlyrKhlUJjzl8gaZ2sP9q4EKj1R98p1XWzmC\nJWXfwe5wg7HbUzt18x6ifSf6QKMmLqPLCDKXnE+O5Th3YO/yCnFoTT0IIIEfv0Bd\nmhYlxVxRycAaywBGX907/g8siAM4gx0ZnWS4z58mnG/FxcuhiTeYLWa3Hqh7Fpg/\nbyWt+K+diYjemeS3b0DwckW6tp4BiDGMsQJ0NHTafT4z+VJ230Fzn0QfOMU=\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIDJjCCAg4CAQEwDQYJKoZIhvcNAQELBQAwWTELMAkGA1UEBhMCQVUxEzARBgNV\nBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0\nZDESMBAGA1UEAwwJdGVzdCB0ZXN0MB4XDTI0MDUxMzExNTY1MFoXDTI1MDUxMzEx\nNTY1MFowWTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNV\nBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDESMBAGA1UEAwwJdGVzdCB0ZXN0\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsIMri9wZBQEyEXP82Sf0\nXCxVx529IPDsjz4AnEBppNDXBn8QK8o6BYjetPudiqNuXsyzTBXZR1/4p0GxYIzL\n+jHJqTfNEmH5hI4vA0UJEAEo9ERB3AiFABjC4q2zmmkFYW92S4oXZVO4jKSt+FO5\n/SSShLXHKSyUN8u4SPCJ/t0WfV6LTOUflYzWb0whWt8ezVPFjPO2Zy1Wc30/rSEz\n5GpG+vHPnCCMtBsPgt6NaN3gBWf47wYLBeI9dooCOY5OkbpWfPK6bl8Epti13EXb\nO1y1hqIHJRFdDuKvOPqWFGffqa6xjQ4u7FyGpuSAtOFaV5ntRcG13E6o8DhmMIHL\nVQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQAR2M9fDe9x8ZNibWeYuD7WYAIedjI/\nNZsYdylD+5bII2Vj1qDOlTlvMgpfBqu1RvUXmHedTpmjcjGduATKsg9HE31HrGrP\n+y1CpRQ/ePXIF7HEveFv6oyJE8LzRetB5h9MqFosPImmJYWx3bvW3kHP8aixoq1o\nDDqyY6jijrIW2w8NhcyrjEje3GiiXpUOI66OpzH+U1a+33icv5enVbKDsxg7JISF\nGwz4SMpKKkg5OEmky0ZkFIupk09LhMq0DsnOuZCKvipCjvrhfP7UMsE0PdXWYgl2\nm8nmpVOinTTuIfmlxnpS9PD/s5CH4zwyD6BvHE0OCzYiVOS0fwpc90Ak\n-----END CERTIFICATE-----\n";
    const std::string private_key = "-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAkkmEOhwgWEqIpju5lL22jYJCQ39ZPL8yXBJr5qznMyHFpnZB\nn9iaHGpkPLdCuFT+ltfp2UtxGq/qEUo1TYlrYAClytpm2no2ykVk6JB0njrBF5mw\n4YPGblNSXZXyRVETWRN9sVvmijmLvvWk29Wrr5efNy2qwPgVVBlrfHf3VuSrBx0W\n7kjgeJ2NQB6WGDTBCNAY4fQVbKvdz4+mD2p7uuivPlo1muyb30voDHrxuNZM9wlY\n1hY5I0mUxOVCoGRh0ylPqDy5XlzNvUzDeCrGx0NCGSD8WLjNmpcrkIr5Dd8qG6Pt\njj5wNHyI3PM3fam4wH4vUC5d0B6cfA9JoJMnJwIDAQABAoIBAEX1VYBqwgcnQdlp\nt5ML9RkQgbsA1H7KGv3QK3zqFDkuPfUhGbolXnIXaS9mHsjDkOs3f5SU0RbHqQMy\nv3IAtXJ4bNEpiEWUa85oyFy19KdVBtHQBLicidFqFHpAAtgmcT/Io/QlNIfHBG9C\nz1/4e74iHxjGxKG7IowRCgfA4W7Se/6ZT/uuf400fMSiUuyKpIP5365oRfROaWQJ\nWD0xt4C8LE+sxeHuIydaoLgibBIICDc5G4sn0nKWVSB7HCBgvL+ouc1XNCDenBSH\nitb0pfRRRQMUOkZdcp/dt9mMzhCtiNmJ9BrAKcU4XGjMhOdpAnydDB/2IH4LKW4a\ndWKHea0CgYEAtSdVkBOAq64FO9qczuGrDjDzZ3R8Ql1Tn0qhkb/NIylP125rfDRZ\nWXEWKrBEbL9IpEHzN5/4xcTP2A1SHRZPcFbpprGhvNNEQTlpOjFZLBmo90KFf/4h\nFh3sS25C2o6ks77De8J54RUgmtvSRN+4XQYUk1mV7vjlRKWAH6OC1jUCgYEAzrpY\nvgztEzXyowLRxIsNcPAkgnmkmVPINvwQTBpPYUfH13++6XCKRh9flIFhdArySrgf\nUQ/cZSYu0mSC+ROWqee6hk9GJRXEgPj5JFK+iE/+oFr0+wYVddyuNd42M5VBwqPN\nQ8JMfwlSDrl1W+/TEFC5tSU4jFeqdYPCoZb9A2sCgYBI/iNs3V7gTktPlcPPXIDX\nRAQfsIENIJu8OI8nsjgPLes87AIlVtaVwopjAwlfJCg5/1ToGe5cifQRozRuAfpa\nUrrs7vAzrJD5ExACYbYDngdGMiimrRhZ2A7JShFoDUfyITCVYoRHnIK5w09Tby3T\nVcreoJ9YXjPLWEBq/zCN7QKBgQCC0JqdUNKoaGfszTjuVUuhHuULh2wn9kNov+KU\nNcXreh+0d0rYr3VgYDP8Zk7DvrWJoK94fT/q5dmVGzNh6Apb4549pWZuyzJ4ppQJ\nby7QVUZ8NHJ3cmccGRRIVCAaTiW5xCt86DO946kAVk00azM1TM/nF/GLpWHhUQpV\ndJUQlwKBgG2pPtZgXmr7/W9mz3j+E82Bcjn8kGvTzHIlHd0fENyvhHkwC2JLCIHG\ne4bT1q8uuIKsujkfAd6oz8+Tnf+dvPea/+JA99GP6C+ZUL75i1UHGp8JNCUON8He\nw9b2iUqt4dJJxzCnJy7R3OfQbPwSRRx9M3zPlbjklf0URn8s6xJx\n-----END RSA PRIVATE KEY-----\n";
    const std::string subject_name = "Internet Widgits Pty Ltd";

    ASSERT_TRUE(m_cert_store.importPrivateKey(private_key, subject_name));

    std::vector<std::string> certs{};
    ASSERT_TRUE(m_cert_store.extractCertsFromCertificateChain(certificate, certs));
    ASSERT_TRUE(m_cert_store.importCertChain(certs));

    ASSERT_TRUE(m_cert_store.deleteCertFromCertStore(subject_name));
    ASSERT_FALSE(m_cert_store.deleteCertFromCertStore(subject_name)); // ensure it no longer exists
}

TEST_F(WincryptCertStoreTest, deleteCertFailureNonExistentSubjectName)
{
    const std::string subject_name = "I don't exist";

    ASSERT_FALSE(m_cert_store.deleteCertFromCertStore(subject_name));
}

#endif // #ifndef WINCRYPT_CERT_STORE_UNITTEST_HPP
